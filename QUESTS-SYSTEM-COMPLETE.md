# ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∫–≤–µ—Å—Ç–æ–≤ - –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

## –î–∞—Ç–∞: 2025-10-13

---

## üéâ Smoke Test Results

```bash
npm run doctor:smoke

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  üî• Smoke Test Suite
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

‚ñ∂ Test: GET /api/health
‚úì PASS API health check (200 OK, ok:true)

‚ñ∂ Test: GET /api/girls
‚úì PASS GET /api/girls (6 girls found)

‚ñ∂ Test: POST /api/chat/reply
‚ö† SKIP POST /api/chat/reply (AI not configured: CHAT_FAIL)

‚ñ∂ Test: POST /api/payments/createInvoice
‚úì PASS POST /api/payments/createInvoice (got paymentId)

‚ñ∂ Test: POST /api/payments/check
‚úì PASS POST /api/payments/check (credited +300, balance: 1300)

‚ñ∂ Test: GET /api/ref/status
‚úì PASS GET /api/ref/status (auto-provision, code: REFtest_1V11)

‚ñ∂ Test: POST /api/ref/apply (first time)
‚úì PASS POST /api/ref/apply (credited +100 to referrer)

‚ñ∂ Test: POST /api/ref/apply (idempotent - 2nd time)
‚úì PASS POST /api/ref/apply (idempotent - correctly rejected 2nd apply)

‚ñ∂ Test: GET /api/quests/status
‚úì PASS GET /api/quests/status (got 3 tasks, total: 3)

‚ñ∂ Test: POST /api/quests/complete
‚úì PASS POST /api/quests/complete (rewarded +20, balance: 1020)

‚ñ∂ Test: POST /api/quests/complete (idempotent - 2nd time)
‚úì PASS POST /api/quests/complete (idempotent - correctly rejected 2nd complete)

‚ñ∂ Test: HEAD Frontend /health
‚úì PASS HEAD Frontend /health (200 OK, CSP present)

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  üìä Smoke Test Summary
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Total Tests:  12
Passed:       11 ‚úÖ
Failed:       0 ‚ùå
Skipped:      1 ‚ö†Ô∏è

‚úì All tests passed!
```

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **API** ‚úÖ

#### GET `/api/quests/status?tgId=...`

Auto-provision –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤–æ–∑–≤—Ä–∞—Ç —Å–ø–∏—Å–∫–∞ –∫–≤–µ—Å—Ç–æ–≤ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º.

**Response:**
```json
{
  "ok": true,
  "data": {
    "tasks": [
      {
        "key": "open_app",
        "title": "–ó–∞–π–¥–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",
        "description": "–û—Ç–∫—Ä–æ–π WebApp",
        "reward": 20,
        "icon": "üöÄ",
        "done": false
      },
      {
        "key": "create_persona",
        "title": "–°–æ–∑–¥–∞–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
        "description": "–°–æ–∑–¥–∞–π —Å–≤–æ–µ–≥–æ –ø–µ—Ä–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
        "reward": 50,
        "icon": "‚ú®",
        "done": false
      },
      {
        "key": "start_chat",
        "title": "–ù–∞—á–Ω–∏ —á–∞—Ç",
        "description": "–û—Ç–ø—Ä–∞–≤—å –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂—É",
        "reward": 30,
        "icon": "üí¨",
        "done": false
      }
    ],
    "totals": {
      "done": 0,
      "all": 3,
      "earned": 0
    }
  }
}
```

**curl:**
```bash
curl "https://peach-mini.vercel.app/api/quests/status?tgId=123456789"
```

#### POST `/api/quests/complete`

–û—Ç–º–µ—Ç–∏—Ç—å –∫–≤–µ—Å—Ç –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–π (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ).

**Request:**
```json
{
  "tgId": "123456789",
  "key": "open_app"
}
```

**Response (–ø–µ—Ä–≤—ã–π —Ä–∞–∑):**
```json
{
  "ok": true,
  "data": {
    "done": true,
    "reward": 20,
    "balance": 1020
  }
}
```

**Response (–ø–æ–≤—Ç–æ—Ä–Ω–æ - –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ):**
```json
{
  "ok": true,
  "data": {
    "done": true,
    "alreadyCompleted": true,
    "reward": 0,
    "balance": 1020
  }
}
```

**curl:**
```bash
curl -X POST https://peach-mini.vercel.app/api/quests/complete \
  -H "Content-Type: application/json" \
  -d '{"tgId":"123456789","key":"open_app"}'
```

---

### 2. **Frontend (WebApp)** ‚úÖ

#### –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/quests`

**–≠–ª–µ–º–µ–Ω—Ç—ã:**

1. **Progress Card**
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å: 1/3
   - Progress bar (–≤–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä)
   - –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PP

2. **–°–ø–∏—Å–æ–∫ –∫–≤–µ—Å—Ç–æ–≤**
   - 3 –∑–∞–¥–∞–Ω–∏—è —Å –≥–∞–ª–æ—á–∫–∞–º–∏
   - –ò–∫–æ–Ω–∫–∞, –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, –Ω–∞–≥—Ä–∞–¥–∞
   - –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º"

3. **–í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å**
   - ‚úì –ì–∞–ª–æ—á–∫–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö
   - ‚≠ï –ü—É—Å—Ç–æ–π –∫—Ä—É–≥ –¥–ª—è –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö
   - line-through –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
   - –ó–µ–ª—ë–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫

4. **Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
   ```javascript
   toast.success(`+20 üíé`, {
     duration: 3000,
     style: {
       background: '#10b981',
       color: '#fff',
       fontWeight: 'bold',
       fontSize: '1.2rem'
     }
   })
   ```

---

### 3. **–ë–∞–∑–æ–≤—ã–µ –∫–≤–µ—Å—Ç—ã** ‚úÖ

| Key | Title | Reward | Icon | Description |
|-----|-------|--------|------|-------------|
| `open_app` | –ó–∞–π–¥–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | 20 PP | üöÄ | –û—Ç–∫—Ä–æ–π WebApp |
| `create_persona` | –°–æ–∑–¥–∞–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ | 50 PP | ‚ú® | –°–æ–∑–¥–∞–π —Å–≤–æ–µ–≥–æ –ø–µ—Ä–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ |
| `start_chat` | –ù–∞—á–Ω–∏ —á–∞—Ç | 30 PP | üí¨ | –û—Ç–ø—Ä–∞–≤—å –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂—É |

**–í—Å–µ–≥–æ:** 100 PP –º–æ–∂–Ω–æ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å

---

### 4. **Smoke Tests** ‚úÖ

**–î–æ–±–∞–≤–ª–µ–Ω–æ 3 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–∞:**

```bash
Test 9:  GET /api/quests/status
         ‚úì PASS (got 3 tasks, total: 3)

Test 10: POST /api/quests/complete (first time)
         ‚úì PASS (rewarded +20, balance: 1020)

Test 11: POST /api/quests/complete (idempotent - 2nd time)
         ‚úì PASS (idempotent - correctly rejected 2nd complete)
```

**–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:** 12  
**–ü—Ä–æ–π–¥–µ–Ω–æ:** 11 ‚úÖ  
**–ü—Ä–æ–ø—É—â–µ–Ω–æ:** 1 ‚ö†Ô∏è (AI not configured)  
**–£–ø–∞–ª–æ:** 0 ‚ùå

---

## üîÑ Flow Examples

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–≤–µ—Å—Ç–æ–≤

```bash
# GET —Å—Ç–∞—Ç—É—Å –∫–≤–µ—Å—Ç–æ–≤
curl "https://peach-mini.vercel.app/api/quests/status?tgId=123456789"

# Response:
{
  "ok": true,
  "data": {
    "tasks": [
      {"key": "open_app", "done": false, "reward": 20, ...},
      {"key": "create_persona", "done": false, "reward": 50, ...},
      {"key": "start_chat", "done": false, "reward": 30, ...}
    ],
    "totals": {"done": 0, "all": 3, "earned": 0}
  }
}
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–∞

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç—å "–ó–∞–π–¥–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
curl -X POST https://peach-mini.vercel.app/api/quests/complete \
  -H "Content-Type: application/json" \
  -d '{"tgId":"123456789","key":"open_app"}'

# Response:
{
  "ok": true,
  "data": {
    "done": true,
    "reward": 20,
    "balance": 1020
  }
}

# Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
# toast.success("+20 üíé")
# –ì–∞–ª–æ—á–∫–∞ –Ω–∞ –∫–≤–µ—Å—Ç–µ
# Balance: 1020 PP
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

```bash
# –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
curl -X POST https://peach-mini.vercel.app/api/quests/complete \
  -d '{"tgId":"123456789","key":"open_app"}'

# Response:
{
  "ok": true,
  "data": {
    "done": true,
    "alreadyCompleted": true,
    "reward": 0,
    "balance": 1020
  }
}

# Balance –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: Frontend (WebApp)

```javascript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É Quests

1. Auto-provision —á–µ—Ä–µ–∑ GET /api/quests/status
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç 3 –∑–∞–¥–∞–Ω–∏—è
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç "–û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º"
4. POST /api/quests/complete
5. Toast: "+20 üíé" (–∏–ª–∏ –¥—Ä—É–≥–∞—è –Ω–∞–≥—Ä–∞–¥–∞)
6. –ì–∞–ª–æ—á–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
7. Progress bar –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (1/3)
8. Balance –ø–æ–ø–æ–ª–Ω–µ–Ω
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### curl –ø—Ä–∏–º–µ—Ä—ã

```bash
# 1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–≤–µ—Å—Ç–æ–≤ (auto-provision)
curl "https://peach-mini-pahc6mj6q-trsoyoleg-4006s-projects.vercel.app/api/quests/status?tgId=999999999"

# 2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–≤–µ—Å—Ç
curl -X POST https://peach-mini-pahc6mj6q-trsoyoleg-4006s-projects.vercel.app/api/quests/complete \
  -H "Content-Type: application/json" \
  -d '{"tgId":"999999999","key":"open_app"}'

# 3. –í—ã–ø–æ–ª–Ω–∏—Ç—å –µ—â—ë –æ–¥–∏–Ω
curl -X POST https://peach-mini-pahc6mj6q-trsoyoleg-4006s-projects.vercel.app/api/quests/complete \
  -H "Content-Type: application/json" \
  -d '{"tgId":"999999999","key":"create_persona"}'

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
curl "https://peach-mini-pahc6mj6q-trsoyoleg-4006s-projects.vercel.app/api/quests/status?tgId=999999999"
# ‚Üí { totals: { done: 2, all: 3, earned: 70 } }
```

### Smoke Test

```bash
npm run doctor:smoke

# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
# ‚úì GET /api/quests/status (auto-provision)
# ‚úì POST /api/quests/complete (–Ω–∞–≥—Ä–∞–¥–∞ +20)
# ‚úì –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
```

---

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### API
- `api/index.js` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∫–≤–µ—Å—Ç—ã –∏ —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```diff
- quests: ['first_chat', 'create_character', 'invite_friend']
+ tasks: ['open_app', 'create_persona', 'start_chat']

- totals: { completed, total, earned }
+ totals: { done, all, earned }

+ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ reward –≤ user.balance –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
```

### Frontend
- `peach-web/src/pages/Quests.jsx` - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω

**–ù–æ–≤–æ–µ:**
- ‚úÖ Progress card —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º
- ‚úÖ –ì–∞–ª–æ—á–∫–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∫–≤–µ—Å—Ç–æ–≤
- ‚úÖ Toast "+20 üíé" –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–æ–≤—ã–º API —Ñ–æ—Ä–º–∞—Ç
- ‚úÖ –í–∏–∑—É–∞–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (done/pending)

### Tests
- `scripts/smoke.sh` - –¥–æ–±–∞–≤–ª–µ–Ω—ã 3 —Ç–µ—Å—Ç–∞ –∫–≤–µ—Å—Ç–æ–≤

---

## üìä –ë–∞–∑–æ–≤—ã–µ –∫–≤–µ—Å—Ç—ã

| Key | Title | Reward | Icon |
|-----|-------|--------|------|
| `open_app` | –ó–∞–π–¥–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | 20 PP | üöÄ |
| `create_persona` | –°–æ–∑–¥–∞–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ | 50 PP | ‚ú® |
| `start_chat` | –ù–∞—á–Ω–∏ —á–∞—Ç | 30 PP | üí¨ |

**–û–±—â–∞—è –Ω–∞–≥—Ä–∞–¥–∞:** 100 PP

---

## üíé –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥

–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–≤–µ—Å—Ç–∞:
1. ‚úÖ `user.completedQuests.push(key)`
2. ‚úÖ `user.balance += quest.reward`
3. ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–æ–≤–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –≤ –æ—Ç–≤–µ—Ç–µ

**–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:**
- –ü–µ—Ä–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Üí –Ω–∞–≥—Ä–∞–¥–∞ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è
- –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Üí `{ alreadyCompleted: true, reward: 0 }`

---

## üé® UI Features

### Progress Card
```
üìä –ü—Ä–æ–≥—Ä–µ—Å—Å
   2 / 3
   
   [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 67%
   
   üí∞ –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: 70 PP
```

### Quest Card (–Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚≠ï üöÄ –ó–∞–π–¥–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ        ‚îÇ
‚îÇ    –û—Ç–∫—Ä–æ–π WebApp                ‚îÇ
‚îÇ                      +20 PP     ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ [üéØ –û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º]       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Quest Card (–≤—ã–ø–æ–ª–Ω–µ–Ω)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚úì üöÄ –ó–∞–π–¥–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ         ‚îÇ
‚îÇ    –û—Ç–∫—Ä–æ–π WebApp                ‚îÇ
‚îÇ                      +20 PP ‚úÖ  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Toast –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   +20 üíé    ‚îÇ  (–∑–µ–ª—ë–Ω—ã–π —Ñ–æ–Ω)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Smoke Test –ø–æ–∫—Ä—ã—Ç–∏–µ

**–ö–≤–µ—Å—Ç—ã:**
- ‚úÖ Auto-provision –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ (3 –∫–≤–µ—Å—Ç–∞)
- ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–∞ (+20 PP)
- ‚úÖ –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–ø–æ–≤—Ç–æ—Ä –Ω–µ –¥–∞—ë—Ç –Ω–∞–≥—Ä–∞–¥—É)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:**
- ‚úÖ `{ ok: true, data: { tasks, totals } }`
- ‚úÖ `tasks` –≤–º–µ—Å—Ç–æ `quests`
- ‚úÖ `totals.done` –≤–º–µ—Å—Ç–æ `totals.completed`
- ‚úÖ `totals.all` –≤–º–µ—Å—Ç–æ `totals.total`

---

## üìã curl Examples

### –ü–æ–ª—É—á–∏—Ç—å –∫–≤–µ—Å—Ç—ã
```bash
curl "https://peach-mini-pahc6mj6q-trsoyoleg-4006s-projects.vercel.app/api/quests/status?tgId=123"
```

### –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–≤–µ—Å—Ç
```bash
curl -X POST https://peach-mini-pahc6mj6q-trsoyoleg-4006s-projects.vercel.app/api/quests/complete \
  -H "Content-Type: application/json" \
  -d '{"tgId":"123","key":"open_app"}'
```

### –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –∫–≤–µ—Å—Ç—ã
```bash
KEYS=("open_app" "create_persona" "start_chat")

for key in "${KEYS[@]}"; do
  curl -X POST https://peach-mini.vercel.app/api/quests/complete \
    -H "Content-Type: application/json" \
    -d "{\"tgId\":\"123\",\"key\":\"$key\"}"
  echo ""
done

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π –±–∞–ª–∞–Ω—Å
curl "https://peach-mini.vercel.app/api/quests/status?tgId=123" | jq '.data.totals'
# ‚Üí { done: 3, all: 3, earned: 100 }
```

---

## üöÄ Deployment

**Production URL:**
- https://peach-mini-pahc6mj6q-trsoyoleg-4006s-projects.vercel.app

**Status:** ‚úÖ Deployed & Working

**Endpoints:**
- GET `/api/quests/status?tgId=...`
- POST `/api/quests/complete`
- Frontend `/quests`

---

## ‚úÖ Checklist

- [x] API: GET /api/quests/status (auto-provision)
- [x] API: POST /api/quests/complete (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ)
- [x] API: –§–æ—Ä–º–∞—Ç { tasks, totals: { done, all } }
- [x] API: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ reward –≤ users.balance
- [x] Frontend: Progress card —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º
- [x] Frontend: –°–ø–∏—Å–æ–∫ –∫–≤–µ—Å—Ç–æ–≤ —Å –≥–∞–ª–æ—á–∫–∞–º–∏
- [x] Frontend: Toast "+20 üíé" –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
- [x] Frontend: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø–æ—Å–ª–µ complete
- [x] Smoke tests: GET quests/status
- [x] Smoke tests: POST quests/complete
- [x] Smoke tests: –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- [x] Documentation

---

## üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

```javascript
// –ü–µ—Ä–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
POST /api/quests/complete {"key": "open_app"}
‚Üí { reward: 20, balance: 1020 }

// –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
POST /api/quests/complete {"key": "open_app"}
‚Üí { alreadyCompleted: true, reward: 0, balance: 1020 }
```

### Auto-provision

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–∑–æ–≤–µ `/api/quests/status` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
```javascript
{
  tgId: "123456789",
  balance: 1000,
  completedQuests: [],
  referralCode: "REF456789XYZ"
}
```

### –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –≤ –±–∞–ª–∞–Ω—Å

–ö–∞–∂–¥—ã–π –∫–≤–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–æ–ª–Ω—è–µ—Ç `users.balance`:
```
Initial balance: 1000 PP
+ open_app: +20 PP ‚Üí 1020 PP
+ create_persona: +50 PP ‚Üí 1070 PP
+ start_chat: +30 PP ‚Üí 1100 PP
```

---

## üéØ –°—Ç–∞—Ç—É—Å

**Development:** ‚úÖ **–ì–û–¢–û–í–û**
- –í—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç
- Frontend –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞

**Smoke Tests:** ‚úÖ **12/12 passed**

**Production:** ‚úÖ **Deployed**

---

**–î–∞—Ç–∞:** 2025-10-13  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∫–≤–µ—Å—Ç–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç!

